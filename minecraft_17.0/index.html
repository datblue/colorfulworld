<html>
<head>
	<meta charset="UTF-8">
	<title>Arm4px_Steve_Editor</title>	
	<script type="text/javascript" src="js/THREE.js"></script>

	<script type="text/javascript" src="js/OrbitControls.js"></script>
	<script src="js/Projector.js"></script>
	<script src="js/CanvasRenderer.js"></script>

	<link href="dist/css/bootstrap-colorpicker.min.css" rel="stylesheet">
	<link href="docs/assets/main.css" rel="stylesheet">

	<script src="dist/js/jquery-3.1.1.min.js"></script>
	<script src="bootstrap.min.js"></script>

	<script src="dist/js/bootstrap-colorpicker.js"></script>
	<style>
		body { 
			margin: 0; overflow: hidden; 
			background-image: url('background-1.jpg');
			background-size: 100%;
		}
		/*canvas { width: 100%; height: 100% }*/
		#to2D{
			position: absolute;
			bottom: 0;
			left: 0;
			margin-left: 40px;
			margin-bottom: 20px;
		}
		#myCanvas{
			display: none;
		}
		#picker{
			position: absolute;
			top: 0;
			left: 40;
		}
		#paintOptions{
			position: absolute;
			top: 0px;
			left: 200px;
		}
		#paintOptions ul{
			height: 69px;
			padding-top: 2px;
			padding-bottom: 1px;
			/*border: 1px solid grey;*/
			background: red;
			padding-left: 0;
			border-radius: 3px;
			background: -webkit-linear-gradient(left, orange, yellow,orange); /* For Safari 5.1 to 6.0 */
			background: -o-linear-gradient(right,); /* For Opera 11.1 to 12.0 */
			background: -moz-linear-gradient(right, orange, yellow,orange); /* For Firefox 3.6 to 15 */
			background: linear-gradient(to right, lightgrey, white,lightgrey); /* Standard syntax (must be last) */
			box-shadow: 2px 2px 2px #888888;
		}
		.active{
			background: white;
			box-shadow: 2px 2px 2px #888888;
		}
		#paintOptions li{
			float: left;
			display: inline-block;
			list-style:  none;
			padding: 4px 6px;
			border-right: 1px solid grey;
		}
		#last-item{
			/*border-bottom: none;*/
		}
		.op-img{
			width: 40px;
			height: 40px;
			padding: 10px;
			border-radius: 4px;		
			display: block;
		}
		.op-img:hover{
			background: white;
			box-shadow: 2px 2px 2px #888888;
			cursor: pointer;
		}

		#download{			
			text-decoration: none;
			border: 1px solid #eeeeee;
			/*background: #cccccc;*/
			background: #cccccc;
			background: -webkit-linear-gradient(#cccccc, #eeeeee, #cccccc); /* For Safari 5.1 to 6.0 */
			background: -o-linear-gradient(#cccccc, #eeeeee,#cccccc); /* For Opera 11.1 to 12.0 */
			background: -moz-linear-gradient(#cccccc, #eeeeee,#cccccc); /* For Firefox 3.6 to 15 */
			background: linear-gradient(#cccccc, #eeeeee,#cccccc); /* Standard syntax (must be last) */
			padding: 6px 10px;
			border-radius: 4px;
			color: black;
		}
		#download:hover{
			background: white;
			cursor: pointer;
		}
		#skin-image-file{			
			text-decoration: none;
			border: 1px solid #eeeeee;
			background: #cccccc;
			background: -webkit-linear-gradient(#cccccc, #eeeeee, #cccccc); /* For Safari 5.1 to 6.0 */
			background: -o-linear-gradient(#cccccc, #eeeeee,#cccccc); /* For Opera 11.1 to 12.0 */
			background: -moz-linear-gradient(#cccccc, #eeeeee,#cccccc); /* For Firefox 3.6 to 15 */
			background: linear-gradient(#cccccc, #eeeeee,#cccccc); /* Standard syntax (must be last) */
			padding: 6px 10px;
			border-radius: 4px;
			color: black;
		}
		#skin-image-file:hover{
			background: white;
			cursor: pointer;
		}
		/*outline*/
		.outline-item{
			background: #cccccc;
			border: 1px solid #cccccc;
		}
		#head{
			position: absolute;
			width: 60px;
			height: 60px;
			background: #cccccc;
			right: 200px;	
			top: 150px;
			/*bottom: 220px;*/
		}
		#body{
			position: absolute;
			width: 60px;
			height: 90px;
			background: #cccccc;
			right: 200px;	
			top: 220px;
			/*bottom: 120px;*/
		}
		#leftArm{
			position: absolute;
			width: 25px;
			height: 90px;
			background: #cccccc;
			right: 165px;	
			top: 220px;
			/*bottom: 120px;*/
		}
		#rightArm{
			position: absolute;
			width: 25px;
			height: 90px;
			background: #cccccc;
			right: 270px;	
			top: 220px;
			/*bottom: 120px;*/
		}
		#leftLeg{
			position: absolute;
			width: 25px;
			height: 90px;
			background: #cccccc;
			right: 200px;	
			top: 320px;
			/*bottom: 20px;*/
		}
		#rightLeg{
			position: absolute;
			width: 25px;
			height: 90px;
			background: #cccccc;
			right: 235px;	
			top: 320px;
			/*bottom: 20px;*/
		}
		.sw{
			position: absolute;
			background: #f0f0f0;
			background: -webkit-linear-gradient(#f0f0f0, white, #f0f0f0); /* For Safari 5.1 to 6.0 */
			background: -o-linear-gradient(#f0f0f0, white,#f0f0f0); /* For Opera 11.1 to 12.0 */
			background: -moz-linear-gradient(#f0f0f0, white,#f0f0f0); /* For Firefox 3.6 to 15 */
			background: linear-gradient(#f0f0f0, #f0ffff,#f0f0f0); /* Standard syntax (must be last) */
			text-align: center;	
			border: grey;	
		}
		.sw:hover{
			cursor: pointer;
		}
		.sw a{
			text-align: center;
			display: inline-block;
			padding-top: 4px;
			height: 100%;
			width: 100%;
		}
		#arm3{
			top: 60px;
			right: 240px;
			height: 30px;
			width: 70px;			
		}
		#arm4{
			top: 60px;
			right: 155px;
			height: 30px;
			width: 70px;
			pointer-events: none;
			background: #cccccc;
			background: -webkit-linear-gradient(#cccccc, #eeeeee, #cccccc); /* For Safari 5.1 to 6.0 */
			background: -o-linear-gradient(#cccccc, #eeeeee,#cccccc); /* For Opera 11.1 to 12.0 */
			background: -moz-linear-gradient(#cccccc, #eeeeee,#cccccc); /* For Firefox 3.6 to 15 */
			background: linear-gradient(#cccccc, #eeeeee,#cccccc); /* Standard syntax (must be last) */
		}
		a{
			text-decoration: none;
		}
		#body-sw{
			top: 100px;
			right: 240px;
			/*height: 30px;*/
			width: 70px;
			padding-top: 6px;
			padding-bottom: 6px;
		}
		#overlay-sw{
			top: 100px;
			right: 155px;
			/*height: 30px;*/
			width: 70px;
			padding-top: 6px;
			padding-bottom: 6px;
		}
		#bk_menu{
			position: absolute;
			bottom: 150px;
			left: 0px;
			list-style-type: none;
		}
		#bk_menu li{
			/*float: left;*/
			margin: 10px;
			margin-left: 0;
			list-style-type: none;		}
			#bk_menu img{
				width: 85px;
				height: 40px;
				border-radius: 5px;
				padding: 4px 6px;
				background: #cccccc;
			}
			#bk_menu img:hover{
				background: white;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<div id="picker" class="inl-bl"></div>		
		<!-- <script> window.onload = function() { $('#picker').colorpicker({ color: '#0c7708', container: true, inline: true }); }; </script> -->
		<div id="paintOptions">
			<ul>
				<li id="areaPaint" onclick="areaPaint()"><img src="paint-bucket.png" class="op-img" id="paint-bucket"></img></li>
				<li onclick="usepen()"><img src="pencil.png" id="pen-img" class="op-img"/></li>
				<li onclick="erase()"><img src="erase.png" class="op-img" id="erase-img" /></li>
				<li onclick="undo()"><img src="undo.png" class="op-img"/></li>
				<li onclick="redo()"><img src="redo.png" class="op-img"/></li>
				<li onclick="move()" style="border-right: none;"><img  id="last-item" src="move.gif" class="op-img"  style="width: 40px;" /></li>
			</ul>
		</div>
		<div id="to2D">
			<!-- <button onclick="draw()">draw</button> -->
			<a id="download" class="btn btn-sm btn-primary" download="minecraftskin.png">Save png</a>	
			<!-- 		<style> .inl-bl { display: inline-block; } </style>  -->
			<input id="skin-image-file" type="file"  onchange="upload()" />
			<img id="upload-img" style="display: none;" />
		</div>
		<canvas id="myCanvas"  width="64" height="64"></canvas>	
		<div id="switches">
			<div id="arm3" class="sw" onclick="swArm3()"><a>3px</a></div>
			<div id="arm4" class="sw"><a>4px</a></div>		
			<div id="body-sw" class="sw" onclick="bodySW()">Body</div>
			<div id="overlay-sw" class="sw" onclick="overlaySW()">Overlay</div>
		</div>
		<div id="outline">
			<div id="head" class="outline-item" onclick="headClick()"></div>			
			<div id="leftArm" class="outline-item" onclick="leftArmClick()"></div>
			<div id="body" class="outline-item" onclick="bodyClick()"></div>
			<div id="rightArm" class="outline-item" onclick="rightArmClick()"></div>
			<div id="leftLeg" class="outline-item" onclick="leftLegClick()"></div>
			<div id="rightLeg" class="outline-item" onclick="rightLegClick()"></div>
		</div>
		<div id="bk_menu">
			<ul>
				<li><img src="background-1.jpg" class="bk_img"></li>
				<li><img src="background-2.jpg" class="bk_img"></li>
				<li><img src="background-3.jpg" class="bk_img"></li>
				<li><img src="background-0.png" class="bk_img"></li>
			</ul>
		</div>
		<script type="text/javascript">
			var scene, camera, renderer;		
			var raycaster = new THREE.Raycaster();

			var mouse = new THREE.Vector2();
			var objects = [];			

			// var WIDTH = 1200, HEIGHT = 600;
			// var WIDTH = window.innerWidth, HEIGHT = window.innerHeight;
			// var WIDTH = containerPosition.width, HEIGHT = containerPosition.height;
			var model;

		// var mouseState =0;
		var paintState =0;
		var eraseState = 0;
		var areaPaintState = 0;
		var penState = 1;

		var moveState = 0;

		var headState = 0;
		var bodyState = 0;		
		var leftArmState = 0;
		var rightArmState = 0;
		var rightLegState = 0;
		var leftLegState = 0;

		var SCENECOLOR = '#ABABAB';
		// var SCENECOLOR = '#FFFF90';
		// var SCENECOLOR = '#e7f42e';
		var OUTLINECOLOR = '#cccccc';
		var SWCOLOR = '#f0f0f0';
		var bodyDisplayState =0;
		var overlayDisplayState =0;

		var workState = [];
		var workMesh = [];

		var redoState = [];
		var redoMesh = [];

		var backgroundMesh;
		var backgroundScene;
		var backgroundCamera;
		// var headBoxDiffX=0;
		// var headBoxDiffY=0;var leftArmBoxDiffX = 0;var rightArmBoxDiffX = 0;var rightLegBoxDiffX = 0; leftLegBoxDiffX =0;

		// var headState, bodyState, leftArmState, rightArmState, leftLegState, rightLegState = true;
		
		// var faceMaterial = new THREE.MeshBasicMaterial({ 
		// 	color:0xFFFFFF, 
		// 	side:THREE.DoubleSide 
		// }); 
		init();
		render();

		function init(){
			// var f = new File([""], "undo.png");
			// var linkfile = URL.createObjectURL(f);

			// var loader =  new THREE.TextureLoader();
			// loader.crossOrigin = 'false';
			// var texture = loader.load("undo.png");
			// backgroundMesh = new THREE.Mesh(
			// 	new THREE.PlaneGeometry(2, 2, 0),
			// 	new THREE.MeshBasicMaterial({
			// 		map: texture
			// 	}));
			// backgroundMesh.material.depthTest = false;
			// backgroundMesh.material.depthWrite = false;
			// backgroundScene = new THREE.Scene();
			// backgroundCamera = new THREE.Camera();
			// backgroundScene.add(backgroundCamera );
			// backgroundScene.add(backgroundMesh );
			// basic factors
			scene = new THREE.Scene();			
			// scene.background = new THREE.Color( 0xABABAB);
			camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );			
			camera.position.set( 0, 0, 34 );			
			camera.lookAt(new THREE.Vector3(0, 0, 0));
			
			renderer = new THREE.CanvasRenderer({ alpha: true });
			// renderer = new THREE.WebGLRenderer();
			renderer.setClearColor( 0x000000, 0);
			// renderer.autoClear = false;
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.sortObjects = true;
			// cameraControls = new THREE.OrbitControls(camera, renderer.domElement);
			cameraControls = new THREE.OrbitControls(camera, renderer.domElement);

			// draw models
			model = new Character(0, 0, 0, 4);
			// var x= 0, y=0,z=0;
   //              var headBorder = new PartFrame(x,y+10,z,8,8,8,1);
   //              scene.add(headBorder);

			// var model = new character4(0, 0, 0);
			//
			window.addEventListener( 'resize', onWindowResize, false );
			window.addEventListener( 'mousedown', onMouseDown, false );
			window.addEventListener( 'mouseup', onMouseUp, false );
			window.addEventListener( 'mousemove', onMouseMove, false );
			// document.body.appendChild( renderer.domElement );
			
			document.body.appendChild(renderer.domElement);
		}

		function Character(x,y,z, a){ // x,y,z is model position // a is arm width (3 or 4)	
			if (a==3){
				var leftArm = new CharacterLeftArm3(x,y,z);	
				var leftArmOverlay = new LeftArm3Overlay(x,y,z);	
				var leftArmBorder = new PartFrame(x+5.5,y,z,3,12,4,1);
				scene.add(leftArmBorder);
				var rightArm = new CharacterRightArm3(x,y,z);
				var rightArmOverlay = new RightArm3Overlay(x,y,z);
				var rightArmBorder = new PartFrame(x-5.5,y,z,3,12,4,1);
				scene.add(rightArmBorder);

			}
			else{
				var leftArm = new CharacterLeftArm4(x,y,z);	
				var leftArmOverlay = new LeftArm4Overlay(x,y,z);	
				var leftArmBorder = new PartFrame(x+6,y,z,4,12,4,1);
				scene.add(leftArmBorder);
				var rightArm = new CharacterRightArm4(x,y,z);	
				var rightArmOverlay = new RightArm4Overlay(x,y,z);
				var rightArmBorder = new PartFrame(x-6,y,z,4,12,4,1);
				scene.add(rightArm.mesh);	
				scene.add(rightArmBorder);



			}
			var head = new CharacterHead(x, y, z);
			var headOverlay = new HeadOverlay(x,y,z);
			// scene.add(headOverlay.mesh);
			var headBorder = new PartFrame(x,y+10,z,8,8,8,1);
			scene.add(headBorder);
			var body = new CharacterBody(x,y,z);
			scene.add(body.mesh);
			var bodyOverlay = new BodyOverlay(x,y,z);			
			scene.add(bodyOverlay.mesh);
			var bodyBorder = new PartFrame(0,0,0,8,12,4,1);
		// var bodyBorder = new PartBorder(0,0,0,8,12,4,1);
		scene.add(bodyBorder);
		var leftLeg = new CharacterLeftLeg(x,y,z);
		// scene.add(leftLeg.mesh);
		var leftLegOverlay = new LeftLegOverlay(x,y,z);
		// scene.add(leftLegOverlay.mesh);
		var leftLegBorder = new PartFrame(x+2,y-12,z,4,12,4,1);
		// var leftLegBorder = new PartBorder(x+2,y-12,z,4,12,4,1);
		scene.add(leftLegBorder);
		var rightLeg = new CharacterRightLeg(x,y,z);
		// scene.add(rightLeg.mesh);
		var rightLegOverlay = new RightLegOverlay(x,y,z);
		// scene.add(rightLegOverlay.mesh);
		var rightLegBorder = new PartFrame(x-2,y-12,z,4,12,4,1);
		// var rightLegBorder = new PartBorder(x-2,y-12,z,4,12,4,1);
		scene.add(rightLegBorder);

		head.mesh.position.set(0,0,0);
		headOverlay.mesh.position.set(0,0,0);		

		this.head = head.mesh;
		this.headOverlay = headOverlay.mesh;
		this.headTop = head.top;
		this.headTopOverlay = headOverlay.top;
		this.headBot = head.bot;
		this.headBotOverlay = headOverlay.bot
		this.headLeft = head.left;
		this.headLeftOverlay = headOverlay.left;
		this.headFront = head.front;
		this.headFrontOverlay = headOverlay.front;
		// this.headFrontOverlay.name = "headFrontOverlay";
		this.headRight =  head.right;
		this.headRightOverlay =  headOverlay.right;
		this.headBack = head.back;
		this.headBackOverlay = headOverlay.back;

		this.headBorder = headBorder;


		this.body = body.mesh;
		this.bodyOverlay = bodyOverlay.mesh;
		this.bodyTop = body.top;
		this.bodyBot = body.bot;
		this.bodyLeft = body.left;
		this.bodyFront = body.front;
		this.bodyRight = body.right;
		this.bodyBack = body.back;

		this.bodyBorder = bodyBorder;

		this.bodyOverlay = bodyOverlay.mesh;
		this.bodyTopOverlay = bodyOverlay.top;
		this.bodyBotOverlay = bodyOverlay.bot;
		this.bodyLeftOverlay = bodyOverlay.left;
		this.bodyFrontOverlay = bodyOverlay.front;
		this.bodyRightOverlay = bodyOverlay.right;
		this.bodyBackOverlay = bodyOverlay.back;
		// this.leftLeg = leftLeg;
		// this.leftLegBorder = leftLegBorder;	

		this.rightLeg = rightLeg.mesh;		
		this.rightLegTop = rightLeg.top;
		this.rightLegBot = rightLeg.bot;
		this.rightLegRight = rightLeg.right;
		this.rightLegFront = rightLeg.front;
		this.rightLegLeft = rightLeg.left;
		this.rightLegBack = rightLeg.back;
		this.rightLegBorder = rightLegBorder;	

		this.rightLegOverlay = rightLegOverlay.mesh;
		this.rightLegTopOverlay = rightLegOverlay.top;
		this.rightLegBotOverlay = rightLegOverlay.bot;
		this.rightLegRightOverlay = rightLegOverlay.right;
		this.rightLegFrontOverlay = rightLegOverlay.front;
		this.rightLegLeftOverlay = rightLegOverlay.left;
		this.rightLegBackOverlay = rightLegOverlay.back;		

		this.leftLeg = leftLeg.mesh;
		this.leftLegTop = leftLeg.top;
		this.leftLegBot = leftLeg.bot;
		this.leftLegRight = leftLeg.right;
		this.leftLegFront = leftLeg.front;
		this.leftLegLeft = leftLeg.left;
		this.leftLegBack = leftLeg.back;
		this.leftLegBorder = leftLegBorder;	

		this.leftLegOverlay = leftLegOverlay.mesh;
		this.leftLegTopOverlay = leftLegOverlay.top;
		this.leftLegBotOverlay = leftLegOverlay.bot;
		this.leftLegRightOverlay = leftLegOverlay.right;
		this.leftLegFrontOverlay = leftLegOverlay.front;
		this.leftLegLeftOverlay = leftLegOverlay.left;
		this.leftLegBackOverlay = leftLegOverlay.back;

		
		
		var headBox = new THREE.Mesh();	
		head.mesh.position.y = -6;	
		headOverlay.mesh.position.y = -6;	
		headBorder.position.y = -6;
		headBox.position.y = 6;
		headBox.add(head.mesh);		
		headBox.add(headOverlay.mesh);
		headBox.add(headBorder);
		scene.add(headBox);
		this.headBox = headBox;		

		var leftLegBox = new THREE.Mesh();
		leftLeg.mesh.position.y = +6;		
		leftLegOverlay.mesh.position.y = +6;		
		leftLegBorder.position.y = +6;
		leftLegBox.position.y = -6;
		leftLegBox.add(leftLeg.mesh);		
		leftLegBox.add(leftLegOverlay.mesh);		
		leftLegBox.add(leftLegBorder);
		scene.add(leftLegBox);
		this.leftLegBox = leftLegBox;

		var rightLegBox = new THREE.Mesh();
		rightLegOverlay.mesh.position.y = +6;		
		rightLeg.mesh.position.y = +6;	
		rightLegBorder.position.y = +6;
		rightLegBox.position.y = -6;
		rightLegBox.add(rightLeg.mesh);		
		rightLegBox.add(rightLegOverlay.mesh);	
		rightLegBox.add(rightLegBorder);
		scene.add(rightLegBox);
		this.rightLegBox = rightLegBox;

		
		this.leftArm = leftArm.mesh;	
		this.leftArmOverlay = leftArmOverlay.mesh;
		this.leftArmTop = leftArm.top;
		this.leftArmTopOverlay = leftArmOverlay.top;
		this.leftArmBot = leftArm.bot;
		this.leftArmBotOverlay = leftArmOverlay.bot;
		this.leftArmLeft = leftArm.left;
		this.leftArmLeftOverlay = leftArmOverlay.left;
		this.leftArmFront = leftArm.front;
		this.leftArmFrontOverlay = leftArmOverlay.front;
		this.leftArmRight = leftArm.right;
		this.leftArmRightOverlay = leftArmOverlay.right;
		this.leftArmBack = leftArm.back;
		this.leftArmBackOverlay = leftArmOverlay.back;

		this.rightArm = rightArm.mesh;
		this.rightArmTop = rightArm.top;
		this.rightArmBot = rightArm.bot;
		this.rightArmRight = rightArm.right;
		this.rightArmFront = rightArm.front;
		this.rightArmLeft = rightArm.left;
		this.rightArmBack = rightArm.back;

		this.rightArmOverlay = rightArmOverlay.mesh;
		this.rightArmTopOverlay = rightArmOverlay.top;
		this.rightArmBotOverlay = rightArmOverlay.bot;
		this.rightArmRightOverlay = rightArmOverlay.right;
		this.rightArmFrontOverlay = rightArmOverlay.front;
		this.rightArmLeftOverlay = rightArmOverlay.left;
		this.rightArmBackOverlay = rightArmOverlay.back;

		this.leftArmBorder = leftArmBorder;
		this.rightArmBorder = rightArmBorder;	

		var leftArmBox = new THREE.Mesh();
		leftArm.mesh.position.y = -6;		
		leftArmOverlay.mesh.position.y = -6;	
		leftArmBorder.position.y = -6;
		leftArmBox.position.y = 6;
		leftArmBox.add(leftArm.mesh);	
		leftArmBox.add(leftArmOverlay.mesh);	
		leftArmBox.add(leftArmBorder);
		scene.add(leftArmBox);
		this.leftArmBox = leftArmBox;

		var rightArmBox = new THREE.Mesh();
		rightArm.mesh.position.y = -6;		
		rightArmOverlay.mesh.position.y = -6;	
		rightArmBorder.position.y = -6;
		rightArmBox.position.y = 6;
		rightArmBox.add(rightArm.mesh);		
		rightArmBox.add(rightArmOverlay.mesh);	
		rightArmBox.add(rightArmBorder);
		scene.add(rightArmBox);
		this.rightArmBox = rightArmBox;		
		
		
		
		

	}
	function PartFrame(x,y,z,m,n,p,r){// border for a part like a leg, a head// x,y,z is position, m,n,p are width, height,depth r is width of a mini square		
		var mesh = new THREE.Mesh();
		//front		
		var line = MyLine(x-m/2,y-n/2,z+p/2,x-m/2,y+n/2,z+p/2);
		mesh.add(line);
		var line = MyLine(x-m/2,y+n/2,z+p/2,x+m/2,y+n/2,z+p/2);
		mesh.add(line);
		var line = MyLine(x+m/2,y+n/2,z+p/2,x+m/2,y-n/2,z+p/2);
		mesh.add(line);
		var line = MyLine(x-m/2,y-n/2,z+p/2,x+m/2,y-n/2,z+p/2);
		mesh.add(line);
		//bot
		var line = MyLine(x-m/2,y-n/2,z+p/2,x-m/2,y-n/2,z-p/2);
		mesh.add(line);
		var line = MyLine(x-m/2,y-n/2,z-p/2,x+m/2,y-n/2,z-p/2);
		mesh.add(line);
		var line = MyLine(x+m/2,y-n/2,z-p/2,x+m/2,y-n/2,z+p/2);
		mesh.add(line);
		//top
		var line = MyLine(x-m/2,y+n/2,z+p/2,x-m/2,y+n/2,z-p/2);
		mesh.add(line);
		var line = MyLine(x-m/2,y+n/2,z-p/2,x+m/2,y+n/2,z-p/2);
		mesh.add(line);
		var line = MyLine(x+m/2,y+n/2,z-p/2,x+m/2,y+n/2,z+p/2);
		mesh.add(line);
		//back
		var line = MyLine(x-m/2,y-n/2,z-p/2,x-m/2,y+n/2,z-p/2);
		mesh.add(line);
		var line = MyLine(x+m/2,y-n/2,z-p/2,x+m/2,y+n/2,z-p/2);
		mesh.add(line);
		// var line = new LineBorder(x-m/2,y-n/2,z+p/2,x-m/2, y+n/2,z+p/2,x+m/2,y+n/2,z+p/2,x+m/2,y-n/2,z+p/2);			
		// mesh.add(line);
		// var line = new LineBorder(x-m/2,y-n/2,z+p/2,x-m/2, y+n/2,z+p/2,x+m/2,y+n/2,z+p/2,x+m/2,y-n/2,z+p/2);			
		// mesh.add(line);
		// var line = new LineBorder(x-m/2,y-n/2,z+p/2,x-m/2, y+n/2,z+p/2,x+m/2,y+n/2,z+p/2,x+m/2,y-n/2,z+p/2);			
		// mesh.add(line);
		return mesh;
	}	
	function MyLine(x1,y1,z1,x2,y2,z2){
		var line = new THREE.Mesh();			
		var geometry = new THREE.Geometry();
		geometry.vertices.push(
			new THREE.Vector3(x1,y1,z1),
			new THREE.Vector3(x2,y2,z2));
		// var material = new THREE.LineBasicMaterial({ color: 0x414842 });
		// var material = new THREE.LineBasicMaterial({ color: 0x999966 });
		// 0x808080
		var material = new THREE.LineBasicMaterial({ color: 0x434343});
		line = new THREE.Line(geometry, material);	
		line.renderOrder = 100;		
		return line;
	}
		function PartBorder(x,y,z,m,n,p,r){// border for a part like a leg, a head// x,y,z is position, m,n,p are width, height,depth r is width of a mini square
			//0,0,0,8,12,4,1
			if(m===3){
				var mesh = new THREE.Mesh();
				for (var i = 0; i <=m-1; i++) {
					var line = new LineBorder(x-1.5+i+1,y-n/2,z+p/2,x-1.5+i+1,y+n/2,z+p/2,x-1.5+i+1,y+n/2,z-p/2,x-1.5+i+1,y-n/2,z-p/2);			
					mesh.add(line);
				}
				for (var i = 0; i <=n-1; i++) {
					var line = new LineBorder(x-1.5,y-n/2+i+1,z+p/2,x-1.5,y-n/2+i+1,z-p/2,x+1.5,y-n/2+i+1,z-p/2,x+1.5,y-n/2+i+1,z+p/2);			
					mesh.add(line);
				}
				for (var i = 0; i <=p; i++) {
					var line = new LineBorder(x-1.5,y-n/2,z-p/2+i,x-1.5,y+n/2,z-p/2+i,x+1.5,y+n/2,z-p/2+i,x+1.5,y-n/2,z-p/2+i);			
					mesh.add(line);
				}
				return mesh;
			}else{
				var mesh = new THREE.Mesh();
				for (var i = 0; i <=m-1; i++) {
					var line = new LineBorder(x-m/2+i+1,y-n/2,z-p/2,x-m/2+i+1,y+n/2,z-p/2,x-m/2+i+1,y+n/2,z+p/2,x-m/2+i+1,y-n/2,z+p/2);			
					mesh.add(line);
				}
				for (var i = 0; i <=p; i++) {
					var line = new LineBorder(x-m/2,y-n/2,z-p/2+i,x-m/2,y+n/2,z-p/2+i,x+m/2,y+n/2,z-p/2+i,x+m/2,y-n/2,z-p/2+i);			
					mesh.add(line);
				}
				for (var i = 0; i <=n-1; i++) {
					var line = new LineBorder(x-m/2,y-n/2+i+1,z-p/2,x-m/2,y-n/2+i+1,z+p/2,x+m/2,y-n/2+i+1,z+p/2,x+m/2,y-n/2+i+1,z-p/2);
					mesh.add(line);
				}
				return mesh;
			}
		}

		function LineBorder(x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4){// border for a side of a part
			var line = new THREE.Mesh();			
			var geometry = new THREE.Geometry();
			geometry.vertices.push(
				new THREE.Vector3(x1,y1,z1),
				new THREE.Vector3(x2,y2,z2),
				new THREE.Vector3(x3,y3,z3),
				new THREE.Vector3(x4,y4,z4),
				new THREE.Vector3(x1,y1,z1)
				);
			var material = new THREE.LineBasicMaterial({ color: 0x999966 });
			line = new THREE.Line(geometry, material);			
			return line;
		}
		function LeftArm4Overlay(x,y,z){
			var s = 0.2;
			var a = (4+s)/4;
			var b = (12+s)/12;
			var c = (4+s)/4;

			var mesh = new THREE.Mesh();

			var front = new overlayPlane(x+6,y,z+2*c,4,12);
			mesh.add(front);
			
			var back = new overlayPlane(x-6,y,z+2*c,4,12);
			back.rotateY(Math.PI);
			mesh.add(back);
			
			var right = new overlayPlane(x,y,z-6+2*a,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);
			
			var left = new overlayPlane(x,y,z+6+2*a,4,12);
			left.rotateY(Math.PI/2);
			mesh.add(left);
			
			var top = new overlayPlane(x+6,y,z+6*b,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);
			
			var bot = new overlayPlane(x+6,y,z-6*b,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;	
		}
		function CharacterLeftArm4(x,y,z){			
			var mesh = new THREE.Mesh();

			var front = new planeSide(x+6,y,z+2,4,12);
			mesh.add(front);
			
			var back = new planeSide(x-6,y,z+2,4,12);
			back.rotateY(Math.PI);
			mesh.add(back);
			
			var right = new planeSide(x,y,z+4,4,12);
			right.rotateY(Math.PI/2);
			mesh.add(right);
			
			var left = new planeSide(x,y,z+8,4,12);
			left.rotateY(+Math.PI/2);
			mesh.add(left);
			
			var top = new planeSide(x+6,y,z+6,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);
			
			var bot = new planeSide(x+6,y,z-6,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;	
		}
		function CharacterLeftLeg(x,y,z){
			var mesh = new THREE.Mesh();

			var front = new planeSide(x+2,y-12,z+2,4,12);
			mesh.add(front);
			
			var back = new planeSide(x-2,y-12,z+2,4,12);
			back.rotateY(+Math.PI);
			mesh.add(back);
			
			var left = new planeSide(x,y-12,z+4,4,12);
			left.rotateY(+Math.PI/2);
			mesh.add(left);
			
			var right = new planeSide(x,y-12,z,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);
			
			var top = new planeSide(x+2,y,z-6,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);
			
			var bot = new planeSide(x+2,y,z-18,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;	
		}
		function LeftLegOverlay(x,y,z){
			var s = 0.2;
			var a = (4+s)/4;
			var b = (12+s)/12;
			var c = (4+s)/4;

			var mesh = new THREE.Mesh();

			var front = new overlayPlane(x+2,y-12,z+2*c,4,12);
			mesh.add(front);
			
			var back = new overlayPlane(x-2,y-12,z+2*c,4,12);
			back.rotateY(+Math.PI);
			mesh.add(back);
			
			var left = new overlayPlane(x,y-12,z+2+2*a,4,12);
			left.rotateY(+Math.PI/2);
			mesh.add(left);
			
			var right = new overlayPlane(x,y-12,z-2+2*a,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);
			
			var top = new overlayPlane(x+2,y,z-12+6*b,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);
			
			var bot = new overlayPlane(x+2,y,z-12-6*b,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;	
		}
		function CharacterRightLeg(x,y,z){
			var mesh = new THREE.Mesh();

			var front = new planeSide(x-2,y-12,z+2,4,12);
			mesh.add(front);
			
			var back = new planeSide(x+2,y-12,z+2,4,12);
			back.rotateY(Math.PI);
			mesh.add(back);
			
			var right = new planeSide(x,y-12,z+4,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);
			
			var left = new planeSide(x,y-12,z,4,12);
			left.rotateY(Math.PI/2);
			mesh.add(left);
			
			var top = new planeSide(x-2,y,z-6,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);
			
			var bot = new planeSide(x-2,y,z-18,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;			
		}
		function RightLegOverlay(x,y,z){
			var s = 0.2;
			var a = (4+s)/4;
			var b = (12+s)/12;
			var c = (4+s)/4;

			var mesh = new THREE.Mesh();

			var front = new overlayPlane(x-2,y-12,z+2*c,4,12);
			mesh.add(front);

			var back = new overlayPlane(x+2,y-12,z+2*c,4,12);
			back.rotateY(Math.PI);
			mesh.add(back);

			var right = new overlayPlane(x,y-12,z+2+2*a,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);

			var left = new overlayPlane(x,y-12,z-2+2*a,4,12);
			left.rotateY(Math.PI/2);
			mesh.add(left);

			var top = new overlayPlane(x-2,y,z-12+6*b,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);

			var bot = new overlayPlane(x-2,y,z-12-6*b,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;			
		}	

		function RightArm4Overlay(x,y,z){
			var s = 0.2;
			var a = (4+s)/4;
			var b = (12+s)/12;
			var c = (4+s)/4;

			var mesh = new THREE.Mesh();
			var front = new overlayPlane(x-6,y,z+2*c,4,12);
			mesh.add(front);

			var back = new overlayPlane(x+6,y,z+2*c,4,12);
			back.rotateY(Math.PI);
			mesh.add(back);

			var left = new overlayPlane(x,y,z-6+2*a,4,12);
			left.rotateY(+Math.PI/2);
			mesh.add(left);

			var right = new overlayPlane(x,y,z+6+2*a,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);

			var top = new overlayPlane(x-6,y,z+6*b,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);

			var bot = new overlayPlane(x-6,y,z-6*b,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;
		}
		function CharacterRightArm4(x,y,z){
			var mesh = new THREE.Mesh();
			var front = new planeSide(x-6,y,z+2,4,12);
			mesh.add(front);

			var back = new planeSide(x+6,y,z+2,4,12);
			back.rotateY(Math.PI);
			mesh.add(back);

			var left = new planeSide(x,y,z-4,4,12);
			left.rotateY(+Math.PI/2);
			mesh.add(left);

			var right = new planeSide(x,y,z+8,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);

			var top = new planeSide(x-6,y,z+6,4,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);

			var bot = new planeSide(x-6,y,z-6,4,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);

			this.mesh = mesh;
			this.top = top;
			this.bot = bot;
			this.left = left;
			this.front = front;
			this.right = right;
			this.back = back;
		}

		function CharacterBody(x,y,z){	
			var mesh = new THREE.Mesh();				

			var front = new planeSide(x,y,z+2,8,12);				
			mesh.add(front);							

			var back = new planeSide(x,y,z+2,8,12);
			back.rotateY(Math.PI);
			mesh.add(back);

			var right = new planeSide(x,y,z+4,4,12);
			right.rotateY(-Math.PI/2);
			mesh.add(right);	

			var left = new planeSide(x,y,z+4,4,12);
			left.rotateY(Math.PI/2);
			mesh.add(left);	

			var top = new planeSide(x,y,z+6,8,4);
			top.rotateX(-Math.PI/2);
			mesh.add(top);

			var bot = new planeSide(x,y,z-6,8,4);
			bot.rotateX(-Math.PI/2);
			mesh.add(bot);		

			this.mesh = mesh;
			this.right = right;
			this.front = front;
			this.left = left;
			this.back = back;
			this.top = top;
			this.bot = bot;	
		}

		function BodyOverlay(x,y,z){	
			var s = 0.2;
				// var d = (8+s)/8;
				var a = (8+s)/8;
				var b = (12+s)/12;
				var c = (4+s)/4;
				var mesh = new THREE.Mesh();				

				var front = new overlayPlane(x,y,z+2*c,8,12);				
				mesh.add(front);							

				var back = new overlayPlane(x,y,z+2*c,8,12);
				back.rotateY(Math.PI);
				mesh.add(back);
				
				var right = new overlayPlane(x,y,z+4*a,4,12);
				right.rotateY(-Math.PI/2);
				mesh.add(right);	
				
				var left = new overlayPlane(x,y,z+4*a,4,12);
				left.rotateY(Math.PI/2);
				mesh.add(left);	
				
				var top = new overlayPlane(x,y,z+6*b,8,4);
				top.rotateX(-Math.PI/2);
				mesh.add(top);
				
				var bot = new overlayPlane(x,y,z-6*b,8,4);
				bot.rotateX(-Math.PI/2);
				mesh.add(bot);		

				this.mesh = mesh;
				this.right = right;
				this.front = front;
				this.left = left;
				this.back = back;
				this.top = top;
				this.bot = bot;	
			}
			function CharacterHead(x,y,z){
				var mesh = new THREE.Mesh();				
				var front = new planeSide(x,y+10,z+4,8,8);
				// alert("headfront: x:"+x+",y:"+(y+10)+",z:"+(z+4));
				mesh.add(front);
				
				var back = new planeSide(x,y+10,z+4,8,8);
				back.rotateY(Math.PI);
				mesh.add(back);
				
				var right = new planeSide(x,y+10,z+4,8,8);
				right.rotateY(-Math.PI/2);
				mesh.add(right);
				
				var left = new planeSide(x,y+10,z+4,8,8);
				left.rotateY(Math.PI/2);
				mesh.add(left);
				
				var top = new planeSide(x,y,z+14,8,8);
				top.rotateX(-Math.PI/2);
				mesh.add(top);
				
				var bot = new planeSide(x,y,z+6,8,8);
				bot.rotateX(-Math.PI/2);
				mesh.add(bot);

				this.mesh = mesh;
				this.right = right;
				this.front = front;
				this.left = left;
				this.back = back;
				this.top = top;
				this.bot = bot;
				// return mesh;
			}

			function HeadOverlay(x,y,z){
				var s = 0.2;
				var d = (8+s)/8;
				var mesh = new THREE.Mesh();				
				var front = new overlayPlane(x,y+10,z+4*d,8,8);
				// alert("headoverlayfront: x:"+x+",y:"+(y+10)+",z:"+(z+4*d));
				mesh.add(front);
				
				var back = new overlayPlane(x,y+10,z+4*d,8,8);
				back.rotateY(Math.PI);
				mesh.add(back);
				
				var right = new overlayPlane(x,y+10,z+4*d,8,8);
				right.rotateY(-Math.PI/2);
				mesh.add(right);
				
				var left = new overlayPlane(x,y+10,z+4*d,8,8);
				left.rotateY(Math.PI/2);
				mesh.add(left);
				
				var top = new overlayPlane(x,y,z+10+4*d,8,8);
				top.rotateX(-Math.PI/2);
				mesh.add(top);
				
				var bot = new overlayPlane(x,y,z+10-4*d,8,8);
				bot.rotateX(-Math.PI/2);
				mesh.add(bot);

				this.mesh = mesh;
				this.right = right;
				this.front = front;
				this.left = left;
				this.back = back;
				this.top = top;
				this.bot = bot;
				// return mesh;
			}

		function planeSide(x,y,z,m,n){ // m,n are width and height of the side
			var mesh = new THREE.Mesh();
			for( var i = 0; i < n;i++){				
				for(var j = 0; j < m ; j++){
					var plane = planeCell(x-m/2+j+0.5,y+n/2-i-0.5,z);
					mesh.add(plane);
				}		
			}
			return mesh;
		}
				function overlayPlane(x,y,z,m,n){ // m,n are width and height of the side
					var mesh = new THREE.Mesh();
					var s = 0.2;
					var a = (m+s)/m;
					var b = (n+s)/n;
					for( var i = 0; i < n;i++){				
						for(var j = 0; j < m ; j++){
							var plane = overlayCell(x-(m/2-j-0.5)*a,y+(n/2-i-0.5)*b,z,a,b);
							mesh.add(plane);
						}		
					}
					return mesh;
				}
				function overlayCell(x,y,z,a,b){						
					// 0xCCCCCC
					var geometry = new THREE.PlaneGeometry( a, b);
					// material = new THREE.MeshBasicMaterial( { color: 0xcccfff, side: THREE.DoubleSide, opacity: 0.5, transparent: true } );
					material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
					var plane = new THREE.Mesh( geometry, material );			
					plane.position.x = x;
					plane.position.y = y;
					plane.position.z = z;
					plane.renderOrder = 10;
					scene.add( plane );// plane.rotateX(5);
					objects.push(plane);										
					return plane;
				}

				function planeCell(x,y,z){	

					var geometry = new THREE.PlaneGeometry( 1, 1);			
					material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
					// material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
					var plane = new THREE.Mesh( geometry, material );			
					plane.position.x = x;
					plane.position.y = y;
					plane.position.z = z;
					plane.renderOrder = 10;
					scene.add( plane );
					objects.push(plane);										
					return plane;
				}
				function onMouseDown(event){
					paintState =0;
					cameraControls.enabled = true;			

					var penColor = $('#picker').colorpicker('getValue', 0xffff00);	

					var canvasPosition = renderer.domElement.getBoundingClientRect();				
					mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
					mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

					raycaster.setFromCamera( mouse, camera );
					var intersects = raycaster.intersectObjects( objects );
					if(penState==1){
						if(intersects.length>0) {	
							cameraControls.enabled = false;
							paintState =1;
							var material = new THREE.MeshBasicMaterial( {color: penColor, side: THREE.DoubleSide } );
							intersects[ 0 ].object.material = material;
							// console.log("oc:"+ color.getHexString());				
							// console.log("pc:"+ penColor);				
							workState.push(material);
							// console.log(workState);
							workMesh.push(intersects[ 0 ].object);
							redoMesh = [];
							redoState = [];
						}	
					}
					if(areaPaintState ==1){
						if(intersects.length>0) {	
							for( var j = 0; j< intersects[ 0 ].object.parent.children.length; j++){		
								paintState =1;
								cameraControls.enabled = false;														
								var material = intersects[ 0 ].object.parent.children[j].material =new THREE.MeshBasicMaterial( { color: penColor, side: THREE.DoubleSide } );		
							}
								// workMesh[workMesh.length] = [];
								// workMesh[workMesh.length].push(intersects[ 0 ].object.parent);
								// workMesh.push(intersects[ 0 ].object.parent.children);
								workMesh.push(intersects[ 0 ].object.parent.children);
								workState.push(material);

								redoMesh = [];
								redoState = [];
							}
						}
						if(eraseState ==1){						
							if(intersects.length>0) {	
								redoMesh = [];
								redoState = [];
								cameraControls.enabled = false;
								paintState =1;
								if (intersects[0].object.material.transparent == false) {
									if(model.headTopOverlay.children.includes(intersects[0].object)||model.headBotOverlay.children.includes(intersects[0].object)||model.headRightOverlay.children.includes(intersects[0].object)||model.headFrontOverlay.children.includes(intersects[0].object)||model.headLeftOverlay.children.includes(intersects[0].object)||model.headBackOverlay.children.includes(intersects[0].object)
										||model.bodyTopOverlay.children.includes(intersects[0].object)||model.bodyBotOverlay.children.includes(intersects[0].object)||model.bodyRightOverlay.children.includes(intersects[0].object)||model.bodyFrontOverlay.children.includes(intersects[0].object)||model.bodyLeftOverlay.children.includes(intersects[0].object)||model.bodyBackOverlay.children.includes(intersects[0].object)
										||model.rightArmTopOverlay.children.includes(intersects[0].object)||model.rightArmBotOverlay.children.includes(intersects[0].object)||model.rightArmRightOverlay.children.includes(intersects[0].object)||model.rightArmFrontOverlay.children.includes(intersects[0].object)||model.rightArmLeftOverlay.children.includes(intersects[0].object)||model.rightArmBackOverlay.children.includes(intersects[0].object)
										||model.leftArmTopOverlay.children.includes(intersects[0].object)||model.leftArmBotOverlay.children.includes(intersects[0].object)||model.leftArmRightOverlay.children.includes(intersects[0].object)||model.leftArmFrontOverlay.children.includes(intersects[0].object)||model.leftArmLeftOverlay.children.includes(intersects[0].object)||model.leftArmBackOverlay.children.includes(intersects[0].object)
										||model.leftLegTopOverlay.children.includes(intersects[0].object)||model.leftLegBotOverlay.children.includes(intersects[0].object)||model.leftLegRightOverlay.children.includes(intersects[0].object)||model.leftLegFrontOverlay.children.includes(intersects[0].object)||model.leftLegLeftOverlay.children.includes(intersects[0].object)||model.leftLegBackOverlay.children.includes(intersects[0].object)
										||model.rightLegTopOverlay.children.includes(intersects[0].object)||model.rightLegBotOverlay.children.includes(intersects[0].object)||model.rightLegRightOverlay.children.includes(intersects[0].object)||model.rightLegFrontOverlay.children.includes(intersects[0].object)||model.rightLegLeftOverlay.children.includes(intersects[0].object)||model.rightLegBackOverlay.children.includes(intersects[0].object)
										){
										var material = intersects[ 0 ].object.material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0, transparent: true } );
									}else{
										var material = intersects[ 0 ].object.material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
									}
										// ( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } )
										workState.push(material);					
										workMesh.push(intersects[ 0 ].object);
									}
								}
							}
						}
						function onMouseUp(event){
							paintState =0;
						}

						function onMouseMove(event){				
							if(paintState ==1)	{
								if(penState==1){
									var penColor = $('#picker').colorpicker('getValue', 0xffff00);					
									var canvasPosition = renderer.domElement.getBoundingClientRect();
									mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
									mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;



									raycaster.setFromCamera( mouse, camera );
									var intersects = raycaster.intersectObjects( objects );
									if(intersects.length>0) {
										cameraControls.enabled = false;	
										var pcolor = new THREE.Color(penColor);									
										if (!intersects[ 0 ].object.material.color.equals(pcolor)) {
											var material = intersects[ 0 ].object.material =new THREE.MeshBasicMaterial( { color: pcolor, side: THREE.DoubleSide } );
									// console.log("oc:"+ pcolor.getHexString());				
									// console.log("pc:"+ penColor);				
									workState.push(material);					
									workMesh.push(intersects[ 0 ].object);
									// console.log(workState);
								}
							}	
						}
						else if (eraseState ==1 ) {
							var penColor = $('#picker').colorpicker('getValue', 0xffff00);					
							var canvasPosition = renderer.domElement.getBoundingClientRect();
							mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
							mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

							raycaster.setFromCamera( mouse, camera );
							var intersects = raycaster.intersectObjects( objects );

							if(intersects.length>0) {
								if (intersects[0].object.material.transparent == false) {
									cameraControls.enabled = false;		
									var ecolor = new THREE.Color(0xCCCCCC);		
									if (!intersects[ 0 ].object.material.color.equals(ecolor)) {
										if(model.headTopOverlay.children.includes(intersects[0].object)||model.headBotOverlay.children.includes(intersects[0].object)||model.headRightOverlay.children.includes(intersects[0].object)||model.headFrontOverlay.children.includes(intersects[0].object)||model.headLeftOverlay.children.includes(intersects[0].object)||model.headBackOverlay.children.includes(intersects[0].object)
											||model.bodyTopOverlay.children.includes(intersects[0].object)||model.bodyBotOverlay.children.includes(intersects[0].object)||model.bodyRightOverlay.children.includes(intersects[0].object)||model.bodyFrontOverlay.children.includes(intersects[0].object)||model.bodyLeftOverlay.children.includes(intersects[0].object)||model.bodyBackOverlay.children.includes(intersects[0].object)
											||model.rightArmTopOverlay.children.includes(intersects[0].object)||model.rightArmBotOverlay.children.includes(intersects[0].object)||model.rightArmRightOverlay.children.includes(intersects[0].object)||model.rightArmFrontOverlay.children.includes(intersects[0].object)||model.rightArmLeftOverlay.children.includes(intersects[0].object)||model.rightArmBackOverlay.children.includes(intersects[0].object)
											||model.leftArmTopOverlay.children.includes(intersects[0].object)||model.leftArmBotOverlay.children.includes(intersects[0].object)||model.leftArmRightOverlay.children.includes(intersects[0].object)||model.leftArmFrontOverlay.children.includes(intersects[0].object)||model.leftArmLeftOverlay.children.includes(intersects[0].object)||model.leftArmBackOverlay.children.includes(intersects[0].object)
											||model.leftLegTopOverlay.children.includes(intersects[0].object)||model.leftLegBotOverlay.children.includes(intersects[0].object)||model.leftLegRightOverlay.children.includes(intersects[0].object)||model.leftLegFrontOverlay.children.includes(intersects[0].object)||model.leftLegLeftOverlay.children.includes(intersects[0].object)||model.leftLegBackOverlay.children.includes(intersects[0].object)
											||model.rightLegTopOverlay.children.includes(intersects[0].object)||model.rightLegBotOverlay.children.includes(intersects[0].object)||model.rightLegRightOverlay.children.includes(intersects[0].object)||model.rightLegFrontOverlay.children.includes(intersects[0].object)||model.rightLegLeftOverlay.children.includes(intersects[0].object)||model.rightLegBackOverlay.children.includes(intersects[0].object)
											){
											var material = intersects[ 0 ].object.material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0, transparent: true } );
										}else{
											var material = intersects[ 0 ].object.material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
										}		
										workState.push(material);					
										workMesh.push(intersects[ 0 ].object);	
									}		 
								}
							}	
						}
					}
				}

				function onWindowResize() {
			// windowHalfX = WIDTH / 2;
			// windowHalfY = HEIGHT / 2;
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			// renderer.setSize( WIDTH, HEIGHT );
			renderer.setSize( window.innerWidth, window.innerHeight );
		}


		function render () {
			requestAnimationFrame( render );



			renderer.render( scene, camera );						
			// renderer.render(scene, camera);
		};
		function headClick(){			
			
			if(headState ==0){				
				document.getElementById('head').style.backgroundColor = SCENECOLOR;
				// document.getElementById('head').style.backgroundColor = 'lightyellow';
				// $('#head').css('color', 'red');
				headState =1;
				// model.head.visible = false;				
				// model.headBorder.visible = false;
				model.headBox.translateX(100000);
				// model.headBorder.translateX(-100000);				
			}else{
				document.getElementById('head').style.backgroundColor = OUTLINECOLOR;
				headState =0;
				// model.head.visible = true;
				// model.headBorder.visible = true;	
				model.headBox.translateX(-100000);
				// model.headBorder.translateX(100000);
			}
		}
		function bodyClick(){
			if(bodyState ==0){
				document.getElementById('body').style.backgroundColor = SCENECOLOR;
				bodyState =1;
				// model.head.visible = false;				
				// model.headBorder.visible = false;
				model.body.translateX(100000);
				model.bodyOverlay.translateX(100000);
				model.bodyBorder.translateX(100000);
			}else{
				document.getElementById('body').style.backgroundColor = OUTLINECOLOR;
				bodyState =0;
				// model.head.visible = true;
				// model.headBorder.visible = true;	
				model.body.translateX(-100000);
				model.bodyOverlay.translateX(-100000);
				model.bodyBorder.translateX(-100000);
			}
		}
		
		function leftArmClick(){
			if(leftArmState ==0){
				document.getElementById('leftArm').style.backgroundColor = SCENECOLOR;
				leftArmState =1;
				model.leftArmBox.translateX(100000);
				
			}else{
				document.getElementById('leftArm').style.backgroundColor = OUTLINECOLOR;
				leftArmState =0;
				model.leftArmBox.translateX(-100000);
				
			}
		}
		function rightArmClick(){
			if(rightArmState ==0){
				document.getElementById('rightArm').style.backgroundColor = SCENECOLOR;
				rightArmState =1;
				model.rightArmBox.translateX(100000);				
			}else{
				document.getElementById('rightArm').style.backgroundColor = OUTLINECOLOR;
				rightArmState =0;
				model.rightArmBox.translateX(-100000);				
			}
		}
		function leftLegClick(){
			if(leftLegState ==0){
				document.getElementById('leftLeg').style.backgroundColor = SCENECOLOR;
				leftLegState =1;
				model.leftLegBox.translateX(100000);
			}else{
				document.getElementById('leftLeg').style.backgroundColor = OUTLINECOLOR;
				leftLegState =0;
				model.leftLegBox.translateX(-100000);
			}
		}
		function rightLegClick(){
			document.getElementById('rightLeg').style.backgroundColor = SCENECOLOR;
			if(rightLegState ==0){
				rightLegState =1;
				model.rightLegBox.translateX(100000);
			}else{
				document.getElementById('rightLeg').style.backgroundColor = OUTLINECOLOR;
				rightLegState =0;			
				model.rightLegBox.translateX(-100000);
			}
		}
		var p = document.getElementById('pen-img');
		var a = document.getElementById('paint-bucket');
		var e = document.getElementById('erase-img');
		var l = document.getElementById('last-item');
		function areaPaint(){			
			areaPaintState =1;
			eraseState =0;
			penState =0;		
			a.className = "op-img active";
			p.className = "op-img";
			e.className = "op-img";
			l.className = "op-img";
		}	
		function erase(){	
			eraseState =1;
			penState =0;				
			areaPaintState =0;
			e.className = "op-img active";
			p.className = "op-img";
			a.className = "op-img";
			l.className = "op-img";
		}
		function usepen(){		
			penState =1;
			areaPaintState =0;
			eraseState =0;
			p.className = "op-img active";
			a.className = "op-img";
			e.className = "op-img";
			l.className = "op-img";
		}
		function draw(){
			//draw body
			var c = document.getElementById("myCanvas");
			var ctx = c.getContext("2d");

			// 2D head
			for(var n = 0; n<model.headTop.children.length;n++){
				var hex = model.headTop.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(8+xpos,ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headBot.children.length;n++){
				var hex = model.headBot.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(16+xpos,ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headRight.children.length;n++){
				var hex = model.headRight.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(0+xpos,8+ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headFront.children.length;n++){
				var hex = model.headFront.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(8+xpos,8+ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headLeft.children.length;n++){
				var hex = model.headLeft.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(16+xpos,8+ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headBack.children.length;n++){
				var hex = model.headBack.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(24+xpos,8+ypos,1,1);				
			}

			// 2D headOverlay
			for(var n = 0; n<model.headTopOverlay.children.length;n++){
				var hex = model.headTopOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+8+xpos,ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headBotOverlay.children.length;n++){
				var hex = model.headBotOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+16+xpos,ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headRightOverlay.children.length;n++){
				var hex = model.headRightOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+0+xpos,8+ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headFrontOverlay.children.length;n++){
				var hex = model.headFrontOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+8+xpos,8+ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headLeftOverlay.children.length;n++){
				var hex = model.headLeftOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+16+xpos,8+ypos,1,1);
				// alert(n);
			}
			for(var n = 0; n<model.headBackOverlay.children.length;n++){
				var hex = model.headBackOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+24+xpos,8+ypos,1,1);				
			}
			//2d rightleg
			for(var n = 0; n<model.rightLegBot.children.length;n++){
				var hex = model.rightLegBot.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(8+xpos,16+ypos,1,1);				
			}
			for(var n = 0; n<model.rightLegTop.children.length;n++){
				var hex = model.rightLegTop.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(4+xpos,16+ypos,1,1);				
			}
			for(var n = 0; n<model.rightLegRight.children.length;n++){
				var hex = model.rightLegRight.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(0+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.rightLegFront.children.length;n++){
				var hex = model.rightLegFront.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(4+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.rightLegLeft.children.length;n++){
				var hex = model.rightLegLeft.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(8+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.rightLegBack.children.length;n++){
				var hex = model.rightLegBack.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(12+xpos,20+ypos,1,1);				
			}
			//2D rightlegoverlay
			for(var n = 0; n<model.rightLegBotOverlay.children.length;n++){
				var hex = model.rightLegBotOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(8+xpos,16+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightLegTopOverlay.children.length;n++){
				var hex = model.rightLegTopOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(4+xpos,16+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightLegRightOverlay.children.length;n++){
				var hex = model.rightLegRightOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(0+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightLegFrontOverlay.children.length;n++){
				var hex = model.rightLegFrontOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(4+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightLegLeftOverlay.children.length;n++){
				var hex = model.rightLegLeftOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(8+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightLegBackOverlay.children.length;n++){
				var hex = model.rightLegBackOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(12+xpos,20+ypos+16,1,1);				
			}
			//2D leftleg
			for(var n = 0; n<model.leftLegTop.children.length;n++){
				var hex = model.leftLegTop.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(20+xpos,48+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegBot.children.length;n++){
				var hex = model.leftLegBot.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(24+xpos,48+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegRight.children.length;n++){
				var hex = model.leftLegRight.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(16+xpos,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegFront.children.length;n++){
				var hex = model.leftLegFront.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(20+xpos,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegLeft.children.length;n++){
				var hex = model.leftLegLeft.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(24+xpos,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegBack.children.length;n++){
				var hex = model.leftLegBack.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(28+xpos,52+ypos,1,1);			
			}
			//2D leftlegOverlay
			for(var n = 0; n<model.leftLegTopOverlay.children.length;n++){
				var hex = model.leftLegTopOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(20+xpos-16,48+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegBotOverlay.children.length;n++){
				var hex = model.leftLegBotOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(24+xpos-16,48+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegRightOverlay.children.length;n++){
				var hex = model.leftLegRightOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(16+xpos-16,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegFrontOverlay.children.length;n++){
				var hex = model.leftLegFrontOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(20+xpos-16,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegLeftOverlay.children.length;n++){
				var hex = model.leftLegLeftOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(24+xpos-16,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftLegBackOverlay.children.length;n++){
				var hex = model.leftLegBackOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(28+xpos-16,52+ypos,1,1);			
			}

			// 2d body
			for(var n = 0; n<model.bodyTop.children.length;n++){
				var hex = model.bodyTop.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);				
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(20+xpos,16+ypos,1,1);				
			}			
			for(var n = 0; n<model.bodyBot.children.length;n++){
				var hex = model.bodyBot.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);				
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(28+xpos,16+ypos,1,1);				
			}
			for(var n = 0; n<model.bodyRight.children.length;n++){
				var hex = model.bodyRight.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(16+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.bodyFront.children.length;n++){
				var hex = model.bodyFront.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);				
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(20+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.bodyBack.children.length;n++){
				var hex = model.bodyBack.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.bodyLeft.children.length;n++){
				var hex = model.bodyLeft.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(28+xpos,20+ypos,1,1);				
			}
			// 2d bodyOverlay
			for(var n = 0; n<model.bodyTopOverlay.children.length;n++){
				var hex = model.bodyTopOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);				
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(20+xpos,16+ypos+16,1,1);				
			}
			for(var n = 0; n<model.bodyBotOverlay.children.length;n++){
				var hex = model.bodyBotOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);				
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(28+xpos,16+ypos+16,1,1);				
			}
			for(var n = 0; n<model.bodyRightOverlay.children.length;n++){
				var hex = model.bodyRightOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(16+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.bodyFrontOverlay.children.length;n++){
				var hex = model.bodyFrontOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);				
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(20+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.bodyBackOverlay.children.length;n++){
				var hex = model.bodyBackOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%8;
				var ypos = Math.floor(n/8);
				ctx.fillRect(32+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.bodyLeftOverlay.children.length;n++){
				var hex = model.bodyLeftOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(28+xpos,20+ypos+16,1,1);				
			}
			//2D rightarm
			for(var n = 0; n<model.rightArmTop.children.length;n++){
				var hex = model.rightArmTop.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(44+xpos,16+ypos,1,1);				
			}			
			for(var n = 0; n<model.rightArmBot.children.length;n++){
				var hex = model.rightArmBot.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(48+xpos,16+ypos,1,1);				
			}
			for(var n = 0; n<model.rightArmRight.children.length;n++){
				var hex = model.rightArmRight.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(40+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.rightArmFront.children.length;n++){
				var hex = model.rightArmFront.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(44+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.rightArmLeft.children.length;n++){
				var hex = model.rightArmLeft.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(48+xpos,20+ypos,1,1);				
			}
			for(var n = 0; n<model.rightArmBack.children.length;n++){
				var hex = model.rightArmBack.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(52+xpos,20+ypos,1,1);				
			}
			//2D rightarmoverlay
			for(var n = 0; n<model.rightArmTopOverlay.children.length;n++){
				var hex = model.rightArmTopOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(44+xpos,16+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightArmBotOverlay.children.length;n++){
				var hex = model.rightArmBotOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(48+xpos,16+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightArmRightOverlay.children.length;n++){
				var hex = model.rightArmRightOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(40+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightArmFrontOverlay.children.length;n++){
				var hex = model.rightArmFrontOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(44+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightArmLeftOverlay.children.length;n++){
				var hex = model.rightArmLeftOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(48+xpos,20+ypos+16,1,1);				
			}
			for(var n = 0; n<model.rightArmBackOverlay.children.length;n++){
				var hex = model.rightArmBackOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(52+xpos,20+ypos+16,1,1);				
			}
			//2d leftarm
			for(var n = 0; n<model.leftArmTop.children.length;n++){
				var hex = model.leftArmTop.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(36+xpos,48+ypos,1,1);				
			}


			for(var n = 0; n<model.leftArmBot.children.length;n++){
				var hex = model.leftArmBot.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(40+xpos,48+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmRight.children.length;n++){
				var hex = model.leftArmRight.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(32+xpos,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmFront.children.length;n++){
				var hex = model.leftArmFront.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(36+xpos,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmLeft.children.length;n++){
				var hex = model.leftArmLeft.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(40+xpos,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmBack.children.length;n++){
				var hex = model.leftArmBack.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(44+xpos,52+ypos,1,1);				
			}
			//2D leftarmoverlay
			for(var n = 0; n<model.leftArmTopOverlay.children.length;n++){
				var hex = model.leftArmTopOverlay.children[n].material.color.getHex(); if(hex == 0) continue;
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){
						hexstring='0'+hexstring;
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(36+xpos+16,48+ypos,1,1);
			}


			for(var n = 0; n<model.leftArmBotOverlay.children.length;n++){
				var hex = model.leftArmBotOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(40+xpos+16,48+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmRightOverlay.children.length;n++){
				var hex = model.leftArmRightOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(32+xpos+16,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmFrontOverlay.children.length;n++){
				var hex = model.leftArmFrontOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(36+xpos+16,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmLeftOverlay.children.length;n++){
				var hex = model.leftArmLeftOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(40+xpos+16,52+ypos,1,1);				
			}
			for(var n = 0; n<model.leftArmBackOverlay.children.length;n++){
				var hex = model.leftArmBackOverlay.children[n].material.color.getHex(); if(hex == 0) continue;		
				// Create gradient
				var grd = ctx.createLinearGradient(0,0,100,0);
				var hexstring = hex.toString(16);
				if(hexstring.length<6){	
					var len = hexstring.length;
					for (i=0; i< 6 - len;i++){		
						hexstring='0'+hexstring;		
					}
				}
				hexstring = '#'+hexstring;
				grd.addColorStop(0,hexstring);
				grd.addColorStop(1,hexstring);
				// grd.addColorStop(1,'rgb($r, $g, $b)');
				// Fill with gradient
				ctx.fillStyle = grd;
				var xpos = n%4;
				var ypos = Math.floor(n/4);
				ctx.fillRect(44+xpos+16,52+ypos,1,1);				
			}
			
		}
		function download() {
			draw();
			var canvas = document.getElementById('myCanvas');
			var dt = canvas.toDataURL();
			this.href = dt;
		}
		document.getElementById('download').addEventListener('click', download, false);
		function upload(){

			var selectedFile = document.getElementById('skin-image-file').files[0];		
			
			// var myTexture = new THREE.TextureLoader().load(selectedFile.name);
			var skinfile = URL.createObjectURL(selectedFile);

			var myimg = URL.createObjectURL(selectedFile);
			var img = new Image();
			img.src = myimg;
			img.onload = function(){
				var context = document.getElementById('myCanvas').getContext('2d');
				context.drawImage(img, 0, 0);
				function upFace(part1,part2, x,y, a){
					var Constructor = window[part1][part2];
					for(var i=0; i< Constructor.children.length; i++){
						var xpos = i%a;
						var ypos = Math.floor(i/a);
						data = context.getImageData(x+xpos, y+ypos, 1, 1).data;
						if(data[3]==0) continue;
						var rgb = "rgb("+data[0]+','+data[1]+','+data[2]+')';
						var color = new THREE.Color(rgb);
						var material = new THREE.MeshBasicMaterial({color: color, side:THREE.DoubleSide });
						Constructor.children[i].material = material;
					}
				}
				upFace("model","headTop",8,0,8);
				upFace("model","headBot",16,0,8);
				upFace("model","headRight",0,8,8);
				upFace("model","headFront",8,8,8);
				upFace("model","headLeft",16,8,8);
				upFace("model","headBack",24,8,8);
				upFace("model","headTopOverlay",8+32,0,8);
				upFace("model","headBotOverlay",16+32,0,8);
				upFace("model","headRightOverlay",0+32,8,8);
				upFace("model","headFrontOverlay",8+32,8,8);
				upFace("model","headLeftOverlay",16+32,8,8);
				upFace("model","headBackOverlay",24+32,0,8);

				upFace("model","bodyTop",20,16,8);
				upFace("model","bodyBot",28,16,8);
				upFace("model","bodyRight",16,20,4);
				upFace("model","bodyFront",20,20,8);
				upFace("model","bodyLeft",28,20,4);
				upFace("model","bodyBack",32,20,8);
				upFace("model","bodyTopOverlay",20,16+16,8);
				upFace("model","bodyBotOverlay",28,16+16,8);
				upFace("model","bodyRightOverlay",16,20+16,4);
				upFace("model","bodyFrontOverlay",20,20+16,8);
				upFace("model","bodyLeftOverlay",28,20+16,4);
				upFace("model","bodyBackOverlay",32,20+16,8);

				upFace("model","rightLegTop",4,16,4);
				upFace("model","rightLegBot",8,16,4);
				upFace("model","rightLegRight",0,20,4);
				upFace("model","rightLegFront",4,20,4);
				upFace("model","rightLegLeft",8,20,4);
				upFace("model","rightLegBack",12,20,4);
				upFace("model","rightLegTopOverlay",4,16+16,4);
				upFace("model","rightLegBotOverlay",8,16+16,4);
				upFace("model","rightLegRightOverlay",0,20+16,4);
				upFace("model","rightLegFrontOverlay",4,20+16,4);
				upFace("model","rightLegLeftOverlay",8,20+16,4);
				upFace("model","rightLegBackOverlay",12,20+16,4);


				upFace("model","rightArmTop",4+40,16,4);
				upFace("model","rightArmBot",8+40,16,4);
				upFace("model","rightArmRight",0+40,20,4);
				upFace("model","rightArmFront",4+40,20,4);
				upFace("model","rightArmLeft",8+40,20,4);
				upFace("model","rightArmBack",12+40,20,4);
				upFace("model","rightArmTopOverlay",4+40,16+16,4);
				upFace("model","rightArmBotOverlay",8+40,16+16,4);
				upFace("model","rightArmRightOverlay",0+40,20+16,4);
				upFace("model","rightArmFrontOverlay",4+40,20+16,4);
				upFace("model","rightArmLeftOverlay",8+40,20+16,4);
				upFace("model","rightArmBackOverlay",12+40,20+16,4);



				upFace("model","leftLegTopOverlay",4,48,4);
				upFace("model","leftLegBotOverlay",8,48,4);
				upFace("model","leftLegRightOverlay",0,52,4);
				upFace("model","leftLegFrontOverlay",4,52,4);
				upFace("model","leftLegLeftOverlay",8,52,4);
				upFace("model","leftLegBackOverlay",12,52,4);
				upFace("model","leftLegTop",4+16,48,4);
				upFace("model","leftLegBot",8+16,48,4);
				upFace("model","leftLegRight",0+16,52,4);
				upFace("model","leftLegFront",4+16,52,4);
				upFace("model","leftLegLeft",8+16,52,4);
				upFace("model","leftLegBack",12+16,52,4);

				upFace("model","leftArmTopOverlay",4+48,48,4);
				upFace("model","leftArmBotOverlay",8+48,48,4);
				upFace("model","leftArmRightOverlay",0+48,52,4);
				upFace("model","leftArmFrontOverlay",4+48,52,4);
				upFace("model","leftArmLeftOverlay",8+48,52,4);
				upFace("model","leftArmBackOverlay",12+48,52,4);
				upFace("model","leftArmTop",4+16+16,48,4);
				upFace("model","leftArmBot",8+16+16,48,4);
				upFace("model","leftArmRight",0+16+16,52,4);
				upFace("model","leftArmFront",4+16+16,52,4);
				upFace("model","leftArmLeft",8+16+16,52,4);
				upFace("model","leftArmBack",12+16+16,52,4);
				// for(var i=0; i< model.headTop.children.length; i++){
				// 	var xpos = i%8;
				// 	var ypos = Math.floor(i/8);
				// 	data = context.getImageData(8+xpos, 0+ypos, 1, 1).data;
				// 	var rgb = "rgb("+data[0]+','+data[1]+','+data[2]+')';
				// 	var color = new THREE.Color(rgb);
				// 	var material = new THREE.MeshBasicMaterial({color: color, side:THREE.DoubleSide });
				// 	model.headTop.children[i].material = material;
				// }
			}	
        }// end upload


        function moveRender(){

        	if(moveState == 1){
        		requestAnimationFrame( moveRender );
        		cameraControls.update();	

        		var now = new Date().getTime() / 1000;

        		var angle	= 1/23 * now*Math.PI*2;			
        		model.headBox.rotation.x	= 1.4 * Math.sin(now*1.5)/4;
        		model.headBox.rotation.y	= Math.sin(now)/4;
        		model.rightArmBox.rotation.x = 1.4 * Math.cos(angle + Math.PI);
        		model.leftArmBox.rotation.x	= 1.4 * Math.cos(angle);        				
        		model.rightLegBox.rotation.x	= 1.4 * Math.cos(angle);
        		model.leftLegBox.rotation.x	= 1.4 * Math.cos(angle + Math.PI);
			// camera.position.x = camera.position.x + 5;
			// camera.rotation.x += 0.5;

			var timer = Date.now() * 0.0001; 

			camera.position.x = Math.cos( timer ) * 40;
			camera.position.z = Math.sin( timer ) * 40;
			camera.lookAt( scene.position );
			renderer.render( scene, camera );

			// headBoxDiffX += model.headBox.rotation.x;
			// headBoxDiffY += model.headBox.rotation.y;
			// rightArmBoxDiffX += model.rightArmBox.rotation.x;
			// leftArmBoxDiffX += model.leftArmBox.rotation.x;			
			// rightLegBoxDiffX += model.rightLegBox.rotation.x;
			// leftLegBoxDiffX += model.leftLegBox.rotation.x;

		}
	}
	function move(){
		l.className = "op-img active";
			// p.className = "op-img";
			// e.className = "op-img";
			// a.className = "op-img";
			if(moveState ==0){
			// alert("leftArmBoxX normal ="+ leftArmBoxX);
			moveState =1;
			moveRender();
			model.headBorder.visible = false;
			model.bodyBorder.visible = false;
			model.rightArmBorder.visible = false;
			model.rightLegBorder.visible = false;
			model.leftArmBorder.visible = false;
			model.leftLegBorder.visible = false;
		}
		else {
			model.headBorder.visible = true;
			model.bodyBorder.visible = true;
			model.rightArmBorder.visible = true;
			model.rightLegBorder.visible = true;
			model.leftArmBorder.visible = true;
			model.leftLegBorder.visible = true;
			moveState = 0; window.cancelAnimationFrame(moveRender);
			// model.headBox.rotation.x = -headBoxDiffX;
			// model.headBox.rotation.y = -headBoxDiffY;
			// model.rightArmBox.rotation.x = -rightArmBoxDiffX;
			// model.leftArmBox.rotation.x = -leftArmBoxDiffX;
			// model.rightLegBox.rotation.x = -rightLegBoxDiffX;
			// model.leftLegBox.rotation.x = -leftLegBoxDiffX;			
			// alert("leftArmBoxDiffX on move ="+ leftArmBoxDiffX);		
		}
	}

	function overlaySW(){			
		if(overlayDisplayState == 0 ){
			document.getElementById("overlay-sw").style.background  =SCENECOLOR;
			overlayDisplayState =1;
			model.headOverlay.translateX(100000);
			model.rightArmOverlay.translateX(100000);
			model.leftArmOverlay.translateX(100000);
			model.rightLegOverlay.translateX(100000);
			model.leftLegOverlay.translateX(100000);
			model.bodyOverlay.translateX(100000);
		}
		else{
			document.getElementById("overlay-sw").style.background = "linear-gradient(#f0f0f0, #f0ffff,#f0f0f0)";
			overlayDisplayState =0;			
			model.headOverlay.translateX(-100000);
			model.rightArmOverlay.translateX(-100000);
			model.leftArmOverlay.translateX(-100000);
			model.rightLegOverlay.translateX(-100000);
			model.leftLegOverlay.translateX(-100000);
			model.bodyOverlay.translateX(-100000);
		}
	}
	function swArm3(){
		var ask = window.confirm("Dữ liệu sẽ mất, bạn có muốn chuyển trang?");
		if (ask) {
			// window.alert("This post was successfully deleted.");

			document.location.href = "index2.html";

		}
	}
	function bodySW(){

		if(bodyDisplayState == 0 ){
			document.getElementById("body-sw").style.background =SCENECOLOR;
			bodyDisplayState =1;
			model.head.translateX(100000);
			model.body.translateX(100000);
			model.rightArm.translateX(100000);
			model.leftArm.translateX(100000);
			model.rightLeg.translateX(100000);
			model.leftLeg.translateX(100000);			
		}
		else{
			document.getElementById("body-sw").style.background = "linear-gradient(#f0f0f0, #f0ffff,#f0f0f0)";
			bodyDisplayState =0;
			model.head.translateX(-100000);
			model.body.translateX(-100000);
			model.rightArm.translateX(-100000);
			model.leftArm.translateX(-100000);
			model.rightLeg.translateX(-100000);
			model.leftLeg.translateX(-100000);
		}
	}
	// $("#paintOptions ul li img").click(function(){
	// 	foreach(var x as $("#paintOptions ul li img").children) x.removeClass = "active";
	// 	this.addClass = "active";
	// });
	$('#picker').colorpicker({ color: '#0c7708', container: true, inline: true });
	function undo(){
		if(workMesh.length>0){
		// var color = new THREE.Color(0x0000ff);
		for(var i = 0; i<model.headTopOverlay.children.length; i++){
			model.headTopOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.headBotOverlay.children.length; i++){
			model.headBotOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.headRightOverlay.children.length; i++){
			model.headRightOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.headFrontOverlay.children.length; i++){
			model.headFrontOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.headLeftOverlay.children.length; i++){
			model.headLeftOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.headBackOverlay.children.length; i++){
			model.headBackOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}

		for(var i = 0; i<model.bodyTopOverlay.children.length; i++){
			model.bodyTopOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.bodyBotOverlay.children.length; i++){
			model.bodyBotOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.bodyRightOverlay.children.length; i++){
			model.bodyRightOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.bodyFrontOverlay.children.length; i++){
			model.bodyFrontOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.bodyLeftOverlay.children.length; i++){
			model.bodyLeftOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.bodyBackOverlay.children.length; i++){
			model.bodyBackOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}

		for(var i = 0; i<model.rightArmTopOverlay.children.length; i++){
			model.rightArmTopOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightArmBotOverlay.children.length; i++){
			model.rightArmBotOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightArmRightOverlay.children.length; i++){
			model.rightArmRightOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightArmFrontOverlay.children.length; i++){
			model.rightArmFrontOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightArmLeftOverlay.children.length; i++){
			model.rightArmLeftOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightArmBackOverlay.children.length; i++){
			model.rightArmBackOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftArmTopOverlay.children.length; i++){
			model.leftArmTopOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftArmBotOverlay.children.length; i++){
			model.leftArmBotOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftArmRightOverlay.children.length; i++){
			model.leftArmRightOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftArmFrontOverlay.children.length; i++){
			model.leftArmFrontOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftArmLeftOverlay.children.length; i++){
			model.leftArmLeftOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftArmBackOverlay.children.length; i++){
			model.leftArmBackOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightLegTopOverlay.children.length; i++){
			model.rightLegTopOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightLegBotOverlay.children.length; i++){
			model.rightLegBotOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightLegRightOverlay.children.length; i++){
			model.rightLegRightOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightLegFrontOverlay.children.length; i++){
			model.rightLegFrontOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightLegLeftOverlay.children.length; i++){
			model.rightLegLeftOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.rightLegBackOverlay.children.length; i++){
			model.rightLegBackOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftLegTopOverlay.children.length; i++){
			model.leftLegTopOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftLegBotOverlay.children.length; i++){
			model.leftLegBotOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftLegRightOverlay.children.length; i++){
			model.leftLegRightOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftLegFrontOverlay.children.length; i++){
			model.leftLegFrontOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftLegLeftOverlay.children.length; i++){
			model.leftLegLeftOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.leftLegBackOverlay.children.length; i++){
			model.leftLegBackOverlay.children[i].material = new THREE.MeshBasicMaterial( { color: 0x000000, side: THREE.DoubleSide, opacity: 0, transparent: true } );
		}
		for(var i = 0; i<model.headTop.children.length; i++){
			model.headTop.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.headBot.children.length; i++){
			model.headBot.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.headRight.children.length; i++){
			model.headRight.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.headFront.children.length; i++){
			model.headFront.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.headLeft.children.length; i++){
			model.headLeft.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.headBack.children.length; i++){
			model.headBack.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}

		for(var i = 0; i<model.bodyTop.children.length; i++){
			model.bodyTop.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.bodyBot.children.length; i++){
			model.bodyBot.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.bodyRight.children.length; i++){
			model.bodyRight.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.bodyFront.children.length; i++){
			model.bodyFront.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.bodyLeft.children.length; i++){
			model.bodyLeft.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.bodyBack.children.length; i++){
			model.bodyBack.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}

		for(var i = 0; i<model.rightArmTop.children.length; i++){
			model.rightArmTop.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightArmBot.children.length; i++){
			model.rightArmBot.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightArmRight.children.length; i++){
			model.rightArmRight.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightArmFront.children.length; i++){
			model.rightArmFront.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightArmLeft.children.length; i++){
			model.rightArmLeft.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightArmBack.children.length; i++){
			model.rightArmBack.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftArmTop.children.length; i++){
			model.leftArmTop.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftArmBot.children.length; i++){
			model.leftArmBot.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftArmRight.children.length; i++){
			model.leftArmRight.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftArmFront.children.length; i++){
			model.leftArmFront.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftArmLeft.children.length; i++){
			model.leftArmLeft.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftArmBack.children.length; i++){
			model.leftArmBack.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightLegTop.children.length; i++){
			model.rightLegTop.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightLegBot.children.length; i++){
			model.rightLegBot.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightLegRight.children.length; i++){
			model.rightLegRight.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightLegFront.children.length; i++){
			model.rightLegFront.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightLegLeft.children.length; i++){
			model.rightLegLeft.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.rightLegBack.children.length; i++){
			model.rightLegBack.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftLegTop.children.length; i++){
			model.leftLegTop.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftLegBot.children.length; i++){
			model.leftLegBot.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftLegRight.children.length; i++){
			model.leftLegRight.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftLegFront.children.length; i++){
			model.leftLegFront.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftLegLeft.children.length; i++){
			model.leftLegLeft.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		for(var i = 0; i<model.leftLegBack.children.length; i++){
			model.leftLegBack.children[i].material = new THREE.MeshBasicMaterial( { color: 0xCCCCCC, side: THREE.DoubleSide, opacity: 0.8, transparent: true } );
		}
		redoState.unshift(workState[workState.length-1]);
		redoMesh.unshift(workMesh[workMesh.length-1]);

		workState.pop();
		workMesh.pop();
		// var mc =0;
		for(var i=0; i<workMesh.length; i++){
			if(workMesh[i].constructor !== Array){
				workMesh[i].material = workState[i];
			}else{
				for(var j=0;j<workMesh[i].length;j++){
					workMesh[i][j].material = workState[i];
				}
			}
		}

	}
}
function redo(){
	if(redoMesh.length>0){
		workMesh.push(redoMesh[0]);
		workState.push(redoState[0]);	
		if(redoMesh[0].constructor !== Array){
		// console.log("rdMesh:"+redoMesh);
		// console.log("wkMesh:"+workMesh);
		redoMesh[0].material = redoState[0];
		// console.log("rdMesh2:"+redoMesh);
		// console.log("wkMesh2:"+workMesh);
	}
	else{
		for(var j=0;j<redoMesh[0].length;j++){
			redoMesh[0][j].material = redoState[0];
		}
	}
	redoMesh.shift();
	redoState.shift();
}
}


window.onload = function() {
	var anchors = document.getElementsByClassName('bk_img');
	for (var i = 0; i < anchors.length; i++) {
		anchors[i].addEventListener('click', changebk, false);
	}
}
function changebk(){
	document.body.style.backgroundImage = "url("+this.src+")";
}
</script>
</body>
</html>	